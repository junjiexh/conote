_format_version: "3.0"
_transform: true

services:
  # Account Service - Routes auth API requests directly
  - name: account-service
    url: http://account-service:8080
    routes:
      - name: auth-routes
        paths:
          - /api/auth
        strip_path: false
        preserve_host: false
    plugins:
      - name: cors
        config:
          origins:
            - "http://localhost:3000"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - X-Requested-With
          exposed_headers:
            - X-Auth-Token
          credentials: true
          max_age: 3600

  # Backend Service - Routes other API requests to Spring Boot
  - name: backend-service
    url: http://backend:8080
    routes:
      - name: backend-api-route
        paths:
          - /api
        strip_path: false
        preserve_host: false
    plugins:
      - name: cors
        config:
          origins:
            - "http://localhost:3000"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
            - X-Requested-With
          exposed_headers:
            - X-Auth-Token
          credentials: true
          max_age: 3600

  # Collaboration Server - Proxies WebSocket traffic
  - name: collab-server
    url: http://collab-server:1234
    routes:
      - name: collab-ws-route
        paths:
          - /collab
        strip_path: true
        preserve_host: false
        protocols:
          - http
          - https
